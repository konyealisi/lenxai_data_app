{% extends 'base.html' %}

{% block extra_css %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css">
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        let facilitySelect = document.getElementById('facility');
        let clientIdSelect = document.getElementById('client_id');
        let dataEntryFields = ['dregimen_po', 'dregimen_pw', 'laspud_po', 'laspud_pw', 'quantityd_po', 'quantityd_pw'];

        function updateDataEntryFields() {
            let facilityId = facilitySelect.value;
            let clientId = clientIdSelect.value;

            if (facilityId && clientId) {
                fetch(`/get_data_entry?facility_id=${facilityId}&client_id=${clientId}`)
                    .then(response => response.json())
                    .then(data => {
                        for (let field of dataEntryFields) {
                            document.getElementById(field).value = data[field];
                        }
                    });
            } else {
                for (let field of dataEntryFields) {
                    document.getElementById(field).value = '';
                }
            }
        }

        facilitySelect.addEventListener('change', updateDataEntryFields);
        clientIdSelect.addEventListener('change', updateDataEntryFields);
    });
</script>
{% endblock %}


{% block content %}
    <h1>Data Validation</h1>

    {% if error_message %}
        <p>Error: {{ error_message }}</p>
    {% else %}
        <form method="POST" action="{{ url_for('validate') }}">
            {{ form.hidden_tag() }}
            <table>
                <tr>
                    <th>Facility</th>
                    <td>{{ form.facility }}</td>
                </tr>
                <tr>
                    <th>Client ID</th>
                    <td>{{ form.client_id }}</td>
                </tr>
                <tr>
                    <th>{{ form.dregimen_po.label }}</th>
                    {% if data_entry.dregimen_po is defined %}
                        <td>{{ data_entry.dregimen_po }}</td>
                    {% else %}
                        <td>Data not available</td>
                    {% endif %}
                    <th>{{ form.dregimen_po_correct.label }}</th>
                    <td>Yes {{ form.dregimen_po_correct(True) }} No {{ form.dregimen_po_correct(False) }}</td>
                </tr>
                <tr>
                    <th>{{ form.dregimen_pw.label }}</th>
                    {% if data_entry.dregimen_pw is defined %}
                        <td>{{ data_entry.dregimen_pw }}</td>
                    {% else %}
                        <td>Data not available</td>
                    {% endif %}
                    <th>{{ form.dregimen_pw_correct.label }}</th>
                    <td>Yes {{ form.dregimen_pw_correct(True) }} No {{ form.dregimen_pw_correct(False) }}</td>
                </tr>
                <tr>
                    <th>{{ form.laspud_po.label }}</th>
                    {% if data_entry.laspud_po is defined %}
                        <td>{{ data_entry.laspud_po }}</td>
                    {% else %}
                        <td>Data not available</td>
                    {% endif %}
                    <th>{{ form.laspud_po_correct.label }}</th>
                    <td>Yes {{ form.laspud_po_correct(True) }} No {{ form.laspud_po_correct(False) }}</td>
                </tr>
                <tr>
                    <th>{{ form.laspud_pw.label }}</th>
                    {% if data_entry.laspud_pw is defined %}
                        <td>{{ data_entry.laspud_pw }}</td>
                    {% else %}
                        <td>Data not available</td>
                    {% endif %}
                    <th>{{ form.laspud_pw_correct.label }}</th>
                    <td>Yes {{ form.laspud_pw_correct(True) }} No {{ form.laspud_pw_correct(False) }}</td>
                </tr>
                <tr>
                    <th>{{ form.quantityd_po.label }}</th>
                    {% if data_entry.quantityd_po is defined %}
                        <td>{{ data_entry.quantityd_po }}</td>
                    {% else %}
                        <td>Data not available</td>
                    {% endif %}
                    <th>{{ form.quantityd_po_correct.label }}</th>
                    <td>Yes {{ form.quantityd_po_correct(True) }} No {{ form.quantityd_po_correct(False) }}</td>
                </tr>
                <tr>
                    <th>{{ form.quantityd_pw.label }}</th>
                    {% if data_entry.quantityd_pw is defined %}
                        <td>{{ data_entry.quantityd_pw }}</td>
                    {% else %}
                        <td>Data not available</td>
                    {% endif %}
                    <th>{{ form.quantityd_pw_correct.label }}</th>
                    <td>Yes {{ form.quantityd_pw_correct(True) }} No {{ form.quantityd_pw_correct(False) }}</td>
                </tr>
            </table>
            {{ form.submit }}
        </form>
    {% endif %}
{% endblock %}


{% block extra_js %}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/js/bootstrap-select.min.js"></script>
{% endblock %}